---
import config from "@/config/config.json";
import Base from "@/layouts/Base.astro";
import { markdownify } from "@/lib/utils/textConverter";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";
import { FaEnvelope, FaGithub } from "react-icons/fa";

const entry = (await getEntry("pages", "contact")) as CollectionEntry<"pages">;
const { email, github, blog_description } = config.contactinfo;
const { title, description, meta_title, image } = entry.data;
---

<Base
  title={title}
  meta_title={meta_title}
  description={description}
  image={image}
>
  <section class="section">
    <div class="container">
      <h1 set:html={markdownify(title)} class="h2 page-heading" />

      <div class="row justify-center">
        <div class="col-8 md:col-10 lg:col-12">
          <!-- ì¸ì‚¬ë§ -->
          <div class="text-center mb-12">
            <p class="text-xl text-text-dark mb-4">
              {blog_description}
            </p>
            <p class="text-text leading-relaxed">
              ê¶ê¸ˆí•œ ì ì´ë‚˜ í•¨ê»˜ ì´ì•¼ê¸°í•˜ê³  ì‹¶ì€ ì£¼ì œê°€ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ 
              ì—°ë½ì£¼ì„¸ìš”! <br />ê°œë°œ ê´€ë ¨ ì§ˆë¬¸, í˜‘ì—… ì œì•ˆ, ë˜ëŠ” ë‹¨ìˆœí•œ ì•ˆë¶€
              ì¸ì‚¬ë„ í™˜ì˜í•©ë‹ˆë‹¤.
            </p>
          </div>

          <!-- ì—°ë½ ì •ë³´ ì¹´ë“œ -->
          <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            <!-- ì´ë©”ì¼ ì¹´ë“œ -->
            <div
              class="bg-light rounded-lg p-6 hover:shadow-lg transition-shadow duration-300"
            >
              <div class="flex items-center mb-3">
                <FaEnvelope className="text-2xl text-primary mr-4" />
                <h3 class="text-xl font-semibold text-text-dark">Email</h3>
              </div>
              <p class="text-text mb-3">
                ê°€ì¥ ë¹ ë¥´ê²Œ ì—°ë½í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
              </p>
              <div class="flex items-center space-x-3">
                <span id="email-display" class="text-primary font-medium"
                  >í´ë¦­í•´ì„œ ì´ë©”ì¼ ì£¼ì†Œ ë³´ê¸°</span
                >
                <button
                  id="email-btn"
                  class="inline-flex items-center px-3 py-1 text-sm bg-primary text-white rounded-md hover:bg-primary/80 transition-colors duration-200"
                  title="ì´ë©”ì¼ ì£¼ì†Œ ë³´ê¸° ë° ë³µì‚¬"
                >
                  <svg
                    class="w-4 h-4 mr-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                    ></path>
                  </svg>
                  ë³´ê¸°
                </button>
              </div>
            </div>

            <!-- GitHub Issues ì¹´ë“œ -->
            <div
              class="bg-light rounded-lg p-6 hover:shadow-lg transition-shadow duration-300"
            >
              <div class="flex items-center mb-3">
                <svg
                  class="w-6 h-6 text-primary mr-4"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-2h-2v2zm0-4h2V7h-2v6z"
                  ></path>
                </svg>
                <h3 class="text-xl font-semibold text-text-dark">
                  GitHub Issues
                </h3>
              </div>
              <p class="text-text mb-4">
                ê°œë°œí•˜ë©´ì„œ ìƒê¸´ ì§ˆë¬¸ì´ë‚˜ ì˜ê²¬, ê°œì„  ì•„ì´ë””ì–´ê°€ ìˆë‹¤ë©´ í¸í•˜ê²Œ
                ë‚¨ê²¨ì£¼ì„¸ìš”.
              </p>
              <div class="flex flex-wrap gap-2">
                <a
                  href={github + "/yujeong0411.github.io/issues"}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center px-3 py-2 text-sm bg-primary text-white rounded-md hover:bg-primary/80 transition-colors duration-200"
                >
                  <svg
                    class="w-4 h-4 mr-1"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                    ></path>
                  </svg>
                  Issues ë³´ê¸°
                </a>
                <a
                  href={github + "/yujeong0411.github.io/issues/new"}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center px-3 py-2 text-sm border-2 border-primary text-primary rounded-md hover:bg-primary hover:text-white transition-colors duration-200"
                >
                  <svg
                    class="w-4 h-4 mr-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 4v16m8-8H4"></path>
                  </svg>
                  ìƒˆ ì§ˆë¬¸í•˜ê¸°
                </a>
              </div>
            </div>

            <!-- GitHub í”„ë¡œí•„ ì¹´ë“œ -->
            <div
              class="bg-light rounded-lg p-6 hover:shadow-lg transition-shadow duration-300"
            >
              <div class="flex items-center mb-3">
                <FaGithub className="text-2xl text-primary mr-4" />
                <h3 class="text-xl font-semibold text-text-dark">
                  GitHub í”„ë¡œí•„
                </h3>
              </div>
              <p class="text-text mb-3">
                ì½”ë“œì™€ í”„ë¡œì íŠ¸ë¥¼ í™•ì¸í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ GitHubì„ ë°©ë¬¸í•´ë³´ì„¸ìš”.
              </p>
              <a
                href={github}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center text-primary hover:text-primary/80 font-medium transition-colors duration-200"
              >
                {github.replace("https://github.com/", "@")}
                <svg
                  class="ml-2 w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                  ></path>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</Base>

<script>
  // ğŸ”§ Astro ì „ìš© ì´ë²¤íŠ¸ ì‚¬ìš© (í˜ì´ì§€ ì´ë™ ì‹œì—ë„ ì‘ë™)
  function initEmailButton() {
    let emailRevealed = false;

    function revealAndCopyEmail() {
      // ìŠ¤íŒ¸ë´‡ ë°©ì§€ë¥¼ ìœ„í•´ JavaScriptë¡œ ì´ë©”ì¼ ìƒì„±
      const user = "Y2hvaXl1amVvbmcwNDEx"; // Base64: choiyujeong0411
      const domain = "Z21haWwuY29t"; // Base64: gmail.com
      const email = atob(user) + "@" + atob(domain);

      const displayElement = document.getElementById("email-display");
      const button = document.getElementById("email-btn");

      // null ì²´í¬
      if (!displayElement || !button) {
        console.error("Required elements not found");
        return;
      }

      if (!emailRevealed) {
        // ì²« í´ë¦­: ì´ë©”ì¼ ì£¼ì†Œ ë³´ì—¬ì£¼ê¸°
        displayElement.textContent = email;
        button.innerHTML =
          '<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 002 2v8a2 2 0 002 2z"/></svg>ë³µì‚¬';
        button.title = "ì´ë©”ì¼ ì£¼ì†Œ ë³µì‚¬";
        emailRevealed = true;
      } else {
        // ë‘ ë²ˆì§¸ í´ë¦­: ë³µì‚¬í•˜ê¸°
        navigator.clipboard
          .writeText(email)
          .then(() => {
            const originalText = button.innerHTML;
            button.innerHTML =
              '<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>ë³µì‚¬ë¨!';
            button.classList.add("bg-green-500");
            setTimeout(() => {
              button.innerHTML = originalText;
              button.classList.remove("bg-green-500");
            }, 2000);
          })
          .catch(() => {
            alert("ì´ë©”ì¼ ì£¼ì†Œ: " + email);
          });
      }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    const emailButton = document.getElementById("email-btn");
    if (emailButton) {
      // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
      emailButton.removeEventListener("click", revealAndCopyEmail);
      emailButton.addEventListener("click", revealAndCopyEmail);
    }
  }

  // Astro í˜ì´ì§€ ë¡œë“œ/ë³€ê²½ ì‹œ ì‹¤í–‰
  document.addEventListener("astro:page-load", initEmailButton);

  // ê¸°ì¡´ ë°©ì‹ë„ ìœ ì§€ (ìƒˆë¡œê³ ì¹¨ ì‹œ)
  document.addEventListener("DOMContentLoaded", initEmailButton);
</script>
